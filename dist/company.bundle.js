(()=>{let e=[],t=1,n=10,o=1,a="all",c="";function d(e){let t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function s(r=1){t=r;const l=d("refreshToken"),i=`http://192.168.0.18:28888/with/com-info?option_type=${a}&option_value=${c}&per_page=${n}&page=${t}`;axios.get(i,{headers:{Authorization:`Bearer ${l}`}}).then((a=>{console.log("성공");const c=a.data.data;console.log("data",c),console.log("파일",a.data),e=c,o=a.data.total_page||1,function(){const a=document.getElementById("companyTableBody");a.innerHTML="";const c=(t-1)*n;e.forEach(((e,t)=>{const n=document.createElement("tr");let o="";"N"===e.chan_yn?o=`<button class="approveBtn" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">승인</button>`:"Y"===e.chan_yn&&(o='<button class="approveCBtn" disabled>완료</button>'),n.innerHTML=`\n        <td>\n            <div class="d-flex align-items-center justify-content-center">\n                <input type="checkbox" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">\n            </div>\n        </td>\n        <td>${c+t+1}</td>\n        <td>${e.c_name}</td>\n        <td>${e.owner_name}</td>\n        <td>${e.c_id}</td>\n        <td>${e.created_date.split(" ")[0]}</td>\n        <td><a href="#" class="download-link" data-f-idx="${e.f_idx}"><img src="images/download.svg" alt="download">${e.o_f_name}</a></td>\n        <td class="buttons"><button class="userBtn moveBtn" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">이동</button></td>\n        <td class="buttons"><button class="categoryBtn moveBtn" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">이동</button></td>\n        <td class="buttons"><button class="boardBtn moveBtn" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">이동</button></td>\n        <td class="buttons">${o}</td>\n        <td class="buttons center-align">\n            <button class="modifyBtn comModify" data-id="${e.com_idx}">수정</button>\n\n            <button class="deleteBtn" data-com-idx="${e.com_idx}" data-c-id="${e.c_id}">삭제</button>\n        </td>\n        `,a.appendChild(n)})),document.querySelectorAll(".download-link").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.getAttribute("data-f-idx"),n=d("accessToken"),o=`http://192.168.0.18:28888/file/download/${t}`;axios.get(o,{headers:{Authorization:`Bearer ${n}`},responseType:"blob"}).then((e=>{console.log("response",e);const t=e.headers["content-disposition"];let n="downloaded_file";if(t&&-1!==t.indexOf("attachment")){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=e&&e[1]&&(n=e[1].replace(/['"]/g,""))}const o=new Blob([e.data],{type:e.headers["content-type"]}),a=window.URL.createObjectURL(o),c=document.createElement("a");c.style.display="none",c.href=a,c.download=n,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(a)})).catch((e=>{console.error("파일 다운로드 오류:",e.response?e.response.data:e.message),e.response&&401===e.response.status?window.logout():handleError(e,"삭제에 실패했습니다.")}))}))})),document.querySelectorAll(".comModify").forEach((t=>{t.addEventListener("click",(function(){const t=this.getAttribute("data-id"),n=e.find((e=>e.com_idx==t));document.getElementById("companyName").value=n.c_name,document.getElementById("representativeName").value=n.owner_name,document.getElementById("businessNumber").value=n.c_id,document.getElementById("registrationDate").textContent=n.created_date.split(" ")[0],document.getElementById("fileInput").value=n.o_f_name,document.getElementById("modifySaveBtn").setAttribute("data-com-idx",n.com_idx),document.getElementById("modifyPopup").style.display="flex"}))})),document.querySelectorAll(".deleteBtn").forEach((e=>{e.addEventListener("click",(function(){!function(e){const n=d("refreshToken");console.log("전송될 데이터:",JSON.stringify(e)),axios.delete("http://192.168.0.18:28888/with/del_com",{data:e,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}).then((e=>{console.log("회사 삭제 응답:",e.data),alert("삭제되었습니다."),localStorage.setItem("currentPage",t),location.reload()})).catch((e=>{console.error("회사 삭제 오류:",e.response?e.response.data:e.message),e.response&&401===e.response.status?window.logout():alert("삭제에 실패했습니다.")}))}([{c_id:this.getAttribute("data-c-id"),com_idx:this.getAttribute("data-com-idx")}])}))})),document.querySelectorAll(".userBtn").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-c-id"),t=this.getAttribute("data-com-idx");console.log("comIdx:",t),console.log("com_id:",e),localStorage.setItem("com_idx",t);const n=d("refreshToken");axios.post(`http://192.168.0.18:28888/with/com-change/${e}`,{},{headers:{Authorization:`Bearer ${n}`},withCredentials:!0}).then((e=>{console.log("서버에서 받은 성공 데이터:",e.data),localStorage.setItem("accessToken",e.data.data.accessToken),localStorage.setItem("refreshToken",e.data.data.refreshToken);const n=localStorage.getItem("accessToken");console.log("Stored accessToken:",n),window.location.href=`user.html?=${t}`})).catch((e=>{console.error("Error during post request:",e),e.response&&401===e.response.status?window.logout():alert("요청 중 오류가 발생했습니다.")}))}))})),document.querySelectorAll(".categoryBtn").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-c-id"),t=this.getAttribute("data-com-idx");console.log("comIdx:",t),console.log("com_id:",e),localStorage.setItem("com_idx",t);const n=d("refreshToken");axios.post(`http://192.168.0.18:28888/with/com-change/${e}`,{},{headers:{Authorization:`Bearer ${n}`},withCredentials:!0}).then((e=>{console.log("서버에서 받은 성공 데이터:",e.data),localStorage.setItem("accessToken",e.data.data.accessToken),localStorage.setItem("refreshToken",e.data.data.refreshToken);const n=localStorage.getItem("accessToken");console.log("Stored accessToken:",n),window.location.href=`category.html?=${t}`})).catch((e=>{e.response&&401===e.response.status?window.logout():alert("요청 중 오류가 발생했습니다.")}))}))})),document.querySelectorAll(".boardBtn").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-c-id"),t=this.getAttribute("data-com-idx");console.log("comIdx:",t),console.log("com_id:",e),localStorage.setItem("com_idx",t);const n=d("refreshToken");axios.post(`http://192.168.0.18:28888/with/com-change/${e}`,{},{headers:{Authorization:`Bearer ${n}`},withCredentials:!0}).then((e=>{console.log("서버에서 받은 성공 데이터:",e.data),localStorage.setItem("accessToken",e.data.data.accessToken),localStorage.setItem("refreshToken",e.data.data.refreshToken);const n=localStorage.getItem("accessToken");console.log("Stored accessToken:",n),window.location.href=`board.html?=${t}`})).catch((e=>{e.response&&401===e.response.status?window.logout():alert("요청 중 오류가 발생했습니다.")}))}))})),document.querySelectorAll(".approveBtn").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-com-idx"),n=this.getAttribute("data-c-id"),o=d("refreshToken");axios.put(`http://192.168.0.18:28888/with/com-approved/${e}/${n}`,{},{headers:{Authorization:`Bearer ${o}`}}).then((e=>{console.log("Approval response:",e.data),alert("승인되었습니다."),localStorage.setItem("currentPage",t),location.reload()})).catch((e=>{console.error("Error approving company:",e.response?e.response.data:e.message),alert("승인에 실패했습니다.")}))}))})),function(){const e=document.getElementById("pagination");e.innerHTML="";const n=document.createElement("li");n.className="page-item",n.innerHTML='<a class="page-link" href="#"><<</a>',n.onclick=e=>{e.preventDefault(),s(1)},e.appendChild(n);let a=Math.max(1,t-Math.floor(2.5)),c=Math.min(o,a+5-1);c-a+1<5&&a>1&&(a=Math.max(1,c-5+1));for(let n=a;n<=c;n++){const o=document.createElement("li");o.className="page-item"+(n===t?" active":"");const a=document.createElement("a");a.className="page-link",a.href="#",a.textContent=n,a.onclick=e=>{e.preventDefault(),s(n)},o.appendChild(a),e.appendChild(o)}const d=document.createElement("li");d.className="page-item",d.innerHTML='<a class="page-link" href="#">>></a>',d.onclick=e=>{e.preventDefault(),s(o)},e.appendChild(d)}()}(),document.querySelector('thead input[type="checkbox"]').checked=!1})).catch((e=>{console.error("Error loading company data:",e.response?e.response.data:e.message)}))}document.addEventListener("DOMContentLoaded",(()=>{document.querySelector('thead input[type="checkbox"]').addEventListener("change",(function(){const e=this.checked;document.querySelectorAll('tbody input[type="checkbox"]').forEach((t=>{t.checked=e}))})),document.getElementById("deleteBtn").addEventListener("click",(()=>{const e=Array.from(document.querySelectorAll('tbody input[type="checkbox"]:checked')).map((e=>({c_id:e.getAttribute("data-c-id"),com_idx:e.getAttribute("data-com-idx")})));e.length>0?function(e){const n=d("refreshToken");console.log("전송될 데이터:",JSON.stringify(e)),axios.delete("http://192.168.0.18:28888/with/del_com",{data:e,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}).then((e=>{console.log("회사 삭제 응답:",e.data),alert("삭제되었습니다."),localStorage.setItem("currentPage",t),location.reload()})).catch((e=>{console.error("회사 삭제 오류:",e.response?e.response.data:e.message),alert("삭제에 실패했습니다.")}))}(e):alert("삭제할 회사를 선택해주세요.")}));const e=localStorage.getItem("currentPage");function o(){const e=document.getElementById("searchSelect"),t=document.getElementById("searchInput");e&&(a=e.value),t&&(c=t.value.trim()),s(1)}e?(t=parseInt(e,10),localStorage.removeItem("currentPage")):t=1,s(t),document.getElementById("searchButton").addEventListener("click",(()=>{o()})),document.getElementById("searchInput").addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),o())})),document.getElementById("itemCountSelect").addEventListener("change",(e=>{n=parseInt(e.target.value,10),s(1)})),document.getElementById("addCompanyBtn").addEventListener("click",(()=>{document.getElementById("registerPopup").style.display="flex"})),document.getElementById("registerAttachBtn").addEventListener("click",(()=>{document.getElementById("registerRealFileInput").click()})),document.getElementById("registerRealFileInput").addEventListener("change",(()=>{const e=document.getElementById("registerFileInput"),t=document.getElementById("registerRealFileInput").files;t.length>0&&(e.value=t[0].name)}))})),document.getElementById("modifySaveBtn").addEventListener("click",(function(){const e=document.getElementById("companyName").value.trim(),n=document.getElementById("representativeName").value.trim(),o=(this.getAttribute("data-com-idx"),document.getElementById("businessNumber").value.trim()),a=new FormData;a.append("owner_name",n),a.append("c_name",e);const c=d("refreshToken");axios.put(`http://192.168.0.18:28888//with/com-change/${o}`,a,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"multipart/form-data"}}).then((e=>{console.log("회사 정보 수정 응답:",e.data),alert("회사 정보가 수정되었습니다."),localStorage.setItem("currentPage",t),location.reload()})).catch((e=>{console.error("회사 정보 수정 오류:",e.response?e.response.data:e.message),e.response&&401===e.response.status?window.logout():alert("수정에 실패했습니다.")}))})),document.getElementById("registerSaveBtn").addEventListener("click",(()=>{const e=document.getElementById("c_name").value.trim(),n=document.getElementById("owner_name").value.trim(),o=document.getElementById("c_id").value.trim(),a=document.querySelector('input[name="status"]:checked').value,c=document.getElementById("registerRealFileInput").files[0],r=new FormData;r.append("c_name",e),r.append("owner_name",n),r.append("c_id",o),r.append("chan_yn",a),r.append("file",c);const l=d("accessToken");axios.post("http://192.168.0.18:28888/with/com-info",r,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}}).then((e=>{console.log("회사 등록 응답:",e.data),alert("회사가 등록되었습니다."),document.getElementById("registerPopup").style.display="none",s(t)})).catch((e=>{console.error("회사 등록 오류:",e.response?e.response.data:e.message),alert("회사 등록에 실패했습니다.")}))})),document.getElementById("attachBtn").addEventListener("click",(function(){document.getElementById("realFileInput").click()})),document.getElementById("realFileInput").addEventListener("change",(function(){const e=document.getElementById("fileInput"),t=this.files;t.length>0&&(e.value=t[0].name)})),document.querySelectorAll(".popup .close").forEach((e=>{e.addEventListener("click",(()=>{e.closest(".popup").style.display="none"}))})),document.querySelectorAll(".cancleBtn").forEach((e=>{e.addEventListener("click",(()=>{e.closest(".popup").style.display="none"}))}))})();